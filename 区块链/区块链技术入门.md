# 以太坊简介

区块链 1.0（2008年）：比特币，点对点的电子现金系统，只能简单的记账转账

区块链 2.0（2014年）：以太坊，不光可以记账，智能合约

区块链 3.0（2017年）：出块速度快，高性能，吞吐量大（代表：EOS，ArcBlock，IOTA）

查询区块信息网站：https://etherscan.io/

简单知识学习网站：https://www.qikegu.com/docs/4768

## 发展阶段

“前沿”(Frontier)-Block#0

​	以太坊的初始阶段，持续时间为 2015 年 7 月 30 日至 2016 年 3 月

“家园”(Homestead)-Block #1,150,000

​	以太坊的第二阶段，于 2016年3月推出

“大都会”(Metropolis)Block#437000

​	以太坊的第三个阶段，于 2017 年 10 月推出的 “拜占庭”（Byzantium）是 Metropolis 的两个硬分叉中的第一个，也是我们现在所处的阶段。

“君士坦丁堡”(Constantinople)

​	Metropolis 阶段的第二部分，计划于 2018 年推出。预计将包括切换到混合 POW/POS 共识算法，以及其他变更。

“宁静”(Serenity)

​	2022 年 9 月 15 日，以太坊更改为 POS 共识机制

​	以太坊的第四个也是最后一个阶段。Serenity尚未有计划的发布日期。

## 重大分叉

https://ethereum.org/zh/history/

1192000 分叉成 eth 和 etc（以太坊经典）

<img src="https://zym-notes.oss-cn-shenzhen.aliyuncs.com/img/image-20220923101218586.png" alt="image-20220923101218586" style="zoom:80%;" />

## 以太坊的特点

以太坊是“世界计算机”，这代表它是一个开源的、全球分布的计算基础设施执行称为智能合约(smartcontract)的程序

使用区块链来同步和存储系统状态以及名为以太币(ether)的加密货币，以计量和约束执行资源成本

本质是一个基于交易的状态机(transaction-based state machine)以太坊平台使开发人员能够构建具有内置经济功能的强大去中心化应用程序(DApp);

在持续自我正常运行的同时，它还减少或消除了审查，第三方界面和交易对手风险

## 以太坊的组成部分

·P2P网络

​	以太坊在以太坊主网络上运行，该网络可在TCP端口30303上寻址，并运行一个名为 ![image-20220923102521103](https://zym-notes.oss-cn-shenzhen.aliyuncs.com/img/image-20220923102521103.png)"DEVp2p"的协议。

交易(Transaction)

​	以太坊交易是网络消息，其中包括发送者(sender)，接收者(receiver)，值(value)和数据的有效载荷(payload)。

以太坊虚拟机(EVM)

​	以太坊状态转换由以太坊虚拟机(EVM)处理，这是一个执行字节码(机器语言指令)的基于堆栈的虚拟机。

数据库(Blockchain)

​	底层，链

​	以太坊的区块链作为数据库(通常是Google的LevelDB)本地存储在每个节点上，包含序列化后的交易和系统状态。

·客户端

​	以太坊有几种可互操作的客户端软件实现，其中最突出的是Go-Ethereum(Geth)和Parity

## 以太坊中的重要概念

- 账户(Account)

    包含地址，余额和随机数，以及可选的存储和代码的对象。

    普通账户(EOA)，存储和代码均为空

    合约账户(Contract)，包含存储和代码

- 地址(Address)

    一般来说，这代表一个 EOA 或合约，它可以在区块链上接收或发送交易。更具体地说，它是 ECDSA（椭圆曲线） 公钥的 keccak 散列的最右边的 160 位。

- 交易(Transaction)

    可以发送以太币和信息

    向合约发送的交易可以调用合约代码，并以信息数据为函数参数

    向空用户发送信息，可以自动生成以信息为代码块的合约账户

- gas

    类似手续费（但不完全），以太坊执行智能合约需要的燃料

    以太坊用于执行智能合约的虚拟燃料。以太坊虚拟机使用核算机制来衡量 gas的消耗量并限制计算资源的消耗。

## 以太坊的货币

以太坊的货币单位称为以太(ether),也可以表示为ETH或符号三。

### 以太币的发行规则：

- 挖矿前(Pre-mine,Genesis)

    2014年7月/8月间，为众筹大约发行了7200万以太币。这些币有的时候被称之为“矿
    前”。众筹阶段之后，以太币每年的产量基本稳定，被限制不超过7200万的25%

- 挖矿产出(Mining）

    区块奖励(block reward)

    叔块奖励(uncle reward)

    叔块引用奖励(uncle referencing reward)

- 以太币产量未来的变化

    以太坊出块机制从工作量证明(PoW)转换为股权证明(PoS)后，以太币的发行会

    有什么变化尚未有定论。股权证明机制将使用一个称为Casperl的协议。在Casper协议下，以太币的发行率将大大低于目前幽灵(GHOST)协议下的发行率。

### 以太坊的挖矿产出

- 区块奖励(Blockrewards)

    每产生一个新区块就会有一笔固定的奖励给矿工，初始是5个以太币，现在是3个。

- 叔块奖励(Unclerewards)

    有些区块被挖得稍晚一些，因此不能作为主区块链的组成部分。比特币称这类区块为“孤块”，并且完全舍弃它们。但是，以太币称它们为“叔块”(uncles)，并且

    在之后的区块中，可以引用它们。如果叔块在之后的区块链中作为叔块被引用，每个叔块会为挖矿者产出区块奖励的7/8。这被称之为叔块奖励。

- 叔块引用奖励(Unclereferencingrewards)

    矿工每引用一个叔块，可以得到区块奖励的1/32作为奖励(最多引用两个叔块)

    这样的一套基于POW的奖励机制，被称为以太坊的“幽灵协议”

### 区块（矿工）收入

- 普通区块收入

    固定奖励（挖矿奖励），每个普通区块都有

    区块内包含的所有程序的gas花费的总和

    如果普通区块引用了叔块，每引用一个叔块可以得到固定奖励的1/32

- 叔块收入

    叔块收入只有一项，就是叔块奖励，计算公式为：

    叔块奖励=（叔块高度+8-引用叔块的区块高度）*普通区块奖励/8

## 幽灵协议（GHOST）

- 以太坊出块时间：设计为 12 秒，实际 14、15 秒左右
- 快速确认会带来区块的高作废率，由此链的安全性也会降低
- “幽灵”协议：Greedy Heaviest Observed SubTree,"GHOST”

计算工作量证明时，不仅包括当前区块的祖区块，父区块，还要包括祖先块的作废的后代区块(“叔块”)，将他们进行综合考虑。

目前的协议要求下探到第七层（最早的简版设计是五层），也就是说，废区块只能以叔区块的身份被其父母的第二代至第七代后辈区块引用，而不能是更远关系的后辈区块。

以太坊付给以“叔区块”身份为新块确认作出贡献的废区块7/8的奖励，把它们纳入计算的“侄子区块”将获得区块奖励的1/32，不过，交易费用不会奖励给叔区块。

## 以太坊和图灵完备

1936年，英国数学家艾伦图灵（Alan Turing)创建了一个计算机的数学模型，它由一个控制器、一个读写头和一根无限长的工作带组成。纸带起着存储的作
用，被分成一个个的小方格（可以看成磁带）；读写头能够读取纸带上的信息，以及将运算结果写进纸带：控制器则负责根据程序对搜集到的信息进行处理。

在每个时刻，机器头都要从当前纸带上读入一个方格信息，然后结合自己的内部状态查找程序表，根据程序输出信息到纸带方格上，并转换自己的内部状态，然后进行移动纸带。

如果上个系统可以模拟任何图灵机，它就被定义为“图灵完备”(Turing Complete)的。这种系统称为通用图灵机(UTM)。

以太坊能够在称为以太坊虚拟机的状态机中执行存储程序，同时向内存读取和写入数据，使其成为图灵完备系统，因此成为通用图灵机。考虑到有限存储器的限制，以太坊可以计算任何可由任何图灵机计算的算法。

简单来说，以太坊中支持循环语句，理论上可以运行“无限循环”的程序。

## 去中心化应用

- 基于以太坊可以创建智能合约(Smart Contract)来构建去中心化应用(Decentralized Application,简称为DApp)

- 以太坊的构想是成为DApps编程开发的平台

- DApp至少由以下组成：

    区块链上的智能合约

    Web前端用户界面

## 基于以太坊的应用

基于以太坊创建新的加密货币(CryptoCurrency,这种能力是2017年各种C0泛滥的技术动因)

基于以太坊创建域名注册系统、博彩系统

基于以太坊开发去中心化的游戏，比如2017年底红极一时的以太猫(CryptoKitties,最高单只猫售价高达8OW美元)

## 代币

代币(token)也称作通证，本意为“令牌”，代表有所有权的资产、货币、权限等在区块链上的抽象

可替代性通证(fungible token)：指的是基于区块链技术发行的，互相可以替代的，可以接近无限拆分的 token

非同质通证(non-fungible token)：指的是基于区块链技术发行的，唯一的，不可替代的，大多数情况下不可拆分的 token，如加密猫(CryptoKitties)

## 名词解释

EIP：Ethereum Improvement Proposals,以太坊改进建议

ERC：Ethereum Request for Comments的缩写，以太坊征求意见。些EIP被标记为ERC,表示试图定义以太坊使用的特定标准的提议

EOA：External Owned Account,外部账户。由以太坊网络的人类用户创建的账户

Ethash：以太坊1.0的工作量证明算法。HD钱包：使用分层确定性(HD protocol)密钥创建和转账协议(BIP32)的钱包。

Keccak256：以太坊中使用的密码哈希函数。Keccak256被标准化为 SHA-3

Nonce：在密码学中，术语nonce用于指代只能使用一次的值。以太坊使用两种类型的随机数，账户随机数和POW随机数

# 初识以太坊

## 以太币的单位

以太坊的货币单位称为以太，也称为 ETH 或符号 三

ether 被细分为更小的单位，直到可能的最小单位，称为 wei;    1 ether = 10^18 wei

以太的值总是在以太坊内部表示为以 wei 表示的无符号整数值。

以太的各种单位都有一个使用国际单位制(S)的科学名称，和一个口语名称。

| **单位**   | **Wei 值** | **Wei**                   |
| ---------- | ---------- | ------------------------- |
| wei        | 1 wei      | 1                         |
| Kwei       | 1e3 wei    | 1,000                     |
| Mwei       | 1e6 wei    | 1,000,000                 |
| Gwei       | 1e9 wei    | 1,000,000,000             |
| microEther | 1e12 wei   | 1,000,000,000,000         |
| milliEther | 1e15 wei   | 1,000,000,000,000,000     |
| Ether      | 1e18 wei   | 1,000,000,000,000,000,000 |

## 以太坊钱包

以太坊钱包是我们进入以太坊系统的门户。它包含了私钥，可以代表我们创建和广播交易。

MetaMask：一个浏览器扩展钱包，可在浏览器中运行。

Jaxx：一款多平台、多币种的钱包，可在各种操作系统上运行，包括Android,iOS,Windows,Mac和Linux。

MyEtherWallet(MEW)：一个基于web的钱包，可以在任何浏览器中运行。

Emerald Wallet：旨在与ETc配合使用，但与其他基于以太坊的区块链兼容。

## 私钥、公钥和地址

私钥(Private Key)

​	以太坊私钥事实上只是一个 256 位的随机数，用于发送以太的交易中创建签名来证明自己对资金的所有权。

公钥(Public Key)

​	公钥是由私钥通过椭圆曲线加密 secp256k1 算法单向生成的 512 位(64字节)数。

地址（Address)

​	地址是由公钥的 Keccak-256 单向哈希，取最后 20 个字节(160位)派生出来的标识符。

## 安全须知

eystore 文件就是加密存储的私钥。所以当系统提示你选择密码时：将其设置为强密码，备份并不要共享。如果你没有密码管理器，请将其写下来并将其存放在带锁的抽屉或保险箱中。要访问账户，你必须同时有 keystore 文件和密码。

助记词可以导出私钥，所以可以认为助记词就是私钥。请使用笔和纸进行物理备份。不要把这个任务留给“以后”，你会忘记。切勿以简单形式存储私钥，尤其是以电子方式存储。

不要将私钥资料存储在电子文档、数码照片、屏幕截图、在线驱动器、加密PDF等中。使用密码管理器或笔和纸。

在转移任何大额金额之前，首先要做一个小的测试交易（例如，小于1美元)。收到测试交易后，再尝试从该钱包发送。

## 切换网络

- Main Network (NetworkID:1)

    主要的、公共的，以太坊区块链。真正的ETH,真正的价值，真正的结果。

- Ropsten Test Network (Network ID:3)

    以太坊公共测试区块链和网络，使用工作量证明共识（挖矿）。该网络上的ETH没有任何价值。

- Kovan Test Network (Network ID:42)

    以太坊公共测试区块链和网络，使用“Aura"协议进行权威证明POA共识（联合签名)。该网络上的ETH没有任何价值。此测试网络仅由Parity支持。

- Rinkeby Test Network (Network ID:4)

    以太坊公共测试区块链和网络，使用“Clique”协议进行权威证明POA共识（联合签名)。该网络上的ETH没有任何价值。

- Localhost 8545

    连接到与浏览器在同一台计算机上运行的节点。该节点可以是任何公共区块链(main或testnet)的一部分，也可以是私有testnet.。

- Custom RPC

    允许将Metamask连接到任意兼容geth的RPc接口的节点。该节点可以是任何公共或私人区块链的一部分。

## 在Remix上构建简单的水龙头合约

remix 网址：https://remix.ethereum.org/