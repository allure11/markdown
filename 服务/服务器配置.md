> è¯¥é…ç½®è¿è¡Œåœ¨æµ‹è¯•æœåŠ¡å™¨ä¸Š è‡ªå¸¦ä¸€äº›ç¯å¢ƒ ä¸ºäº†çœäº‹æœ¬æ¬¡ç›´æ¥åœ¨å®¿ä¸»æœºä¸Šè¿è¡ŒJenkins

# OpenJDK8

jdk ä¸‹è½½é“¾æ¥ï¼š[https://www.oracle.com/cn/java/technologies/downloads/](https://www.oracle.com/cn/java/technologies/downloads/)
é€‰æ‹©éœ€è¦å®‰è£…çš„ç‰ˆæœ¬ï¼Œè¿›è¡Œä¸‹è½½ï¼Œè¿™é‡Œä»¥ JDK8u341 ç‰ˆæœ¬ä¸ºä¾‹
![](https://cdn.nlark.com/yuque/0/2022/png/25916449/1665988832446-91b7300f-c686-44ec-8b4e-42711019ffe6.png#clientId=u73405852-6468-4&errorMessage=unknown error&from=paste&id=u11e9e7b2&originHeight=873&originWidth=1920&originalType=url&ratio=1&rotation=0&showTitle=false&status=error&style=none&taskId=u8f04a644-3da6-48db-a274-c24845555d2&title=)
ä½¿ç”¨ Xftp å°†è½¯ä»¶åŒ…ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œè§£å‹ jdk è½¯ä»¶åŒ… tar -zxvf jdk-8u341-linux-x64.tar.gz
å°†è§£å‹å¥½çš„è½¯ä»¶å¤åˆ¶åˆ°å®‰è£…ç›®å½• cp -r jdk1.8.0_341/ /usr/local/
é…ç½®ç¯å¢ƒå˜é‡ï¼Œä¿®æ”¹ vi /etc/profile æ–‡ä»¶ï¼Œé…ç½®å¥½ JAVA_HOME ç­‰ç¯å¢ƒå˜é‡ï¼Œåœ¨æ–‡ä»¶æœ€ä¸‹æ–¹æ·»åŠ å¦‚ä¸‹é…ç½®

```
# JAVA_HOME
export JAVA_HOME=/usr/local/jdk1.8.0_341 Â #jdkå®‰è£…ç›®å½•
export JRE_HOME=${JAVA_HOME}/jre
export CLASSPATH=.:${JAVA_HOME}/lib:${JRE_HOME}/lib:$CLASSPATH
export JAVA_PATH=${JAVA_HOME}/bin:${JRE_HOME}/bin
export PATH=$PATH:${JAVA_PATH}
```
é‡æ–°è½½å…¥ /etc/profile é…ç½® source /etc/profile
æŸ¥çœ‹ jdk ç‰ˆæœ¬å·éªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸï¼š

```
[root@ip-172-31-39-169 centos]# java -version
java version "1.8.0_341"
Java(TM) SE Runtime Environment (build 1.8.0_341-b10)
Java HotSpot(TM) 64-Bit Server VM (build 25.341-b10, mixed mode)
```
# Maven

maven ä¸‹è½½é“¾æ¥ï¼š[https://maven.apache.org/download.cgi](https://maven.apache.org/download.cgi)
é€‰æ‹©å¯¹åº”çš„è½¯ä»¶åŒ…è¿›è¡Œä¸‹è½½ï¼Œå¹¶ä½¿ç”¨ Xftp å°†å…¶ä¸Šä¼ è¿›æœåŠ¡å™¨
![](https://cdn.nlark.com/yuque/0/2022/png/25916449/1665988832473-eb773fe2-c79c-45f6-ba13-dadd06206330.png#clientId=u73405852-6468-4&errorMessage=unknown%20error&from=paste&id=u6d6ddbaa&originHeight=1032&originWidth=1920&originalType=url&ratio=1&rotation=0&showTitle=false&status=error&style=none&taskId=u47cbbec6-ee9d-49ca-888e-b08b581cf87&title=)
è§£å‹è½¯ä»¶åŒ… tar -zxvf apache-maven-3.8.6-bin.tar.gz
å°†è§£å‹å¥½çš„è½¯ä»¶å¤åˆ¶åˆ°å®‰è£…ç›®å½• cp -r apache-maven-3.8.6 /usr/local/
åˆ›å»ºä¾èµ–å­˜æ”¾ç›®å½• mkdir /usr/local/apache-maven-3.8.6/directory
è¿›å…¥ maven çš„é…ç½®æ–‡ä»¶ç›®å½• cd /usr/local/apache-maven-3.8.6/conf
ä¿®æ”¹ settings é…ç½®æ–‡ä»¶ vim settings.xmlï¼Œæ·»åŠ  localRepository æ ‡ç­¾é…ç½®ä¾èµ–å­˜æ”¾ç›®å½•ï¼Œæ·»åŠ  id ä¸º my-profile çš„ profile é…ç½®é•œåƒå›½å†…åœ°å€ã€‚
é…ç½®å†…å®¹å‚è€ƒï¼š[https://blog.csdn.net/zxd1435513775/article/details/99294705](https://blog.csdn.net/zxd1435513775/article/details/99294705)
å¤šé•œåƒé…ç½®å‚è€ƒï¼š[å¼ ç”Ÿè£-åšå®¢](https://www.zhangshengrong.com/p/AvN6YkkQam) å’Œ [åšå®¢å›­-å°æŠ€æœ¯å›](https://www.cnblogs.com/smalltechnologyjun/p/15104096.html)

```xml
<?xml version="1.0" encoding="UTF-8"?>

<settings xmlns="http://maven.apache.org/SETTINGS/1.2.0"
 Â  Â  Â  Â  Â xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
 Â  Â  Â  Â  Â xsi:schemaLocation="http://maven.apache.org/SETTINGS/1.2.0 http://maven.apache.org/xsd/settings-1.2.0.xsd">
 Â <localRepository>/usr/local/apache-maven-3.8.6/directory</localRepository>

 Â <pluginGroups></pluginGroups>
 Â <proxies></proxies>
 Â <servers></servers>
 Â  Â 
 Â <profiles>
    <profile>
     Â <id>jdk-1.8</id>
     Â <activation>
        <activeByDefault>true</activeByDefault>
        <jdk>1.8</jdk>
     Â </activation>
     Â <properties>
        <maven.compiler.source>1.8</maven.compiler.source>
        <maven.compiler.target>1.8</maven.compiler.target>
        <maven.compiler.compilerVersion>1.8</maven.compiler.compilerVersion>
     Â </properties>
    </profile>

    <profile>
        <id>my-profile</id>
        <repositories>
            <repository>
             Â <id>alirepo1</id>
             Â <name>org.maven.repo1</name>
             Â <layout>default</layout>
             Â <!-- <url>https://repo1.maven.org/</url> -->
             Â <url>http://maven.aliyun.com/nexus/content/groups/public</url>
             Â <snapshots>
                <enabled>false</enabled>
             Â </snapshots>
            </repository>

            <repository>
             Â <id>maven-default-http-blocker</id>
             Â <name>Pseudo repository to mirror external repositories initially using HTTP.</name>
             Â <layout>default</layout>
             Â <url>http://0.0.0.0/</url>
             Â <snapshots>
                <enabled>false</enabled>
             Â </snapshots>
            </repository>

            <repository>
             Â <id>spring-milestones</id>
             Â <name>Spring Milestones</name>
             Â <url>https://repo.spring.io/milestone</url>
             Â <snapshots>
                <enabled>false</enabled>
             Â </snapshots>
            </repository>

            <repository>
             Â <id>repository.springframework.maven.release</id>
             Â <name>Spring Framework Maven Release Repository</name>
             Â <url>http://maven.springframework.org/milestone/</url>
            </repository>
            <repository>
             Â <id>org.springframework</id>
             Â <url> http://maven.springframework.org/snapshot</url>
            </repository>
            <repository>
             Â <id>spring-milestone</id>
             Â <name>Spring Maven MILESTONE Repository</name>
             Â <url>http://repo.spring.io/libs-milestone</url>
            </repository>
            <repository>
             Â <id>spring-release</id>
             Â <name>Spring Maven RELEASE Repository</name>
             Â <url>http://repo.spring.io/libs-release</url>
            </repository>
        </repositories>
    </profile>
 Â </profiles>

 Â <activeProfiles> <!--æ¿€æ´»profile-->
 Â  Â <activeProfile>my-profile</activeProfile>
 Â </activeProfiles>
</settings>
```
ä¿®æ”¹ /etc/profile é…ç½®æ–‡ä»¶ vim /etc/profileï¼Œåœ¨æ–‡ä»¶æœ«å°¾é…ç½® MAVEN_HOME åœ°å€ï¼Œå¦‚ä¸‹
```
export MAVEN_HOME=/usr/local/apache-maven-3.8.6
export PATH=$PATH:$MAVEN_HOME/bin
```
é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶ source /etc/profile
ä½¿ç”¨å‘½ä»¤ mvn -v æ£€éªŒ maven æ˜¯å¦å®‰è£…æˆåŠŸ
```
[root@ip-172-31-39-169 local]# mvn -v
Apache Maven 3.8.6 (84538c9988a25aec085021c365c560670ad80f63)
Maven home: /usr/local/apache-maven-3.8.6
Java version: 1.8.0_341, vendor: Oracle Corporation, runtime: /usr/local/jdk1.8.0_341/jre
Default locale: en_US, platform encoding: UTF-8
OS name: "linux", version: "3.10.0-1160.76.1.el7.x86_64", arch: "amd64", family: "unix"
```
# Gitå®¢æˆ·ç«¯

```shell
# ç›´æ¥é€šè¿‡ yum å®‰è£…
yml install -y git
```
# Jenkins

## å®‰è£…

1. ä¸Šä¼ Jenkinsçš„waråŒ…
2. å¯åŠ¨ï¼šnohup java -jar jenkins.war  >jenkins.log 2>&1 &
3. å®‰è£…é»˜è®¤æ¨èæ’ä»¶
4. å®‰è£…Maven integerationå’ŒPublish Over SSHæ’ä»¶ 

![image-20230317162719197](https://zym-notes.oss-cn-shenzhen.aliyuncs.com/img/image-20230317162719197.png)
## é…ç½®æµç¨‹
éœ€è¦å®‰è£…é…ç½®å¥½ jdkã€mavenã€git
å…¨å±€æ ¹æ®é…ç½®ä¸­è¿›è¡Œé…ç½®
![](https://cdn.nlark.com/yuque/0/2022/png/25916449/1665988832469-6fbf4cb1-bf58-46be-8de8-db7f01b070eb.png#clientId=u73405852-6468-4&errorMessage=unknown%20error&from=paste&id=u9137a6bc&originHeight=804&originWidth=1416&originalType=url&ratio=1&rotation=0&showTitle=false&status=error&style=none&taskId=u12658ec2-a507-47a9-844c-dea573d7a29&title=)
### è®¾ç½®jdk
![](https://cdn.nlark.com/yuque/0/2022/png/25916449/1665988832664-62596e34-0e16-46cd-8d31-00ec69cd2f14.png#clientId=u73405852-6468-4&errorMessage=unknown%20error&from=paste&id=uc9913949&originHeight=553&originWidth=955&originalType=url&ratio=1&rotation=0&showTitle=false&status=error&style=none&taskId=ucaeee0dc-f339-4795-81a8-8e50b650abe&title=)
### è®¾ç½®Git
![](https://cdn.nlark.com/yuque/0/2022/png/25916449/1665988832474-67215263-4135-4aa2-838f-648b69c0a46d.png#clientId=u73405852-6468-4&errorMessage=unknown%20error&from=paste&id=uf5322568&originHeight=506&originWidth=939&originalType=url&ratio=1&rotation=0&showTitle=false&status=error&style=none&taskId=u66c9c9c8-75a1-4fb1-8b4f-194423201bf&title=)
### è®¾ç½®maven
![](https://cdn.nlark.com/yuque/0/2022/png/25916449/1665988833360-cd60aa1c-4a45-4548-b774-42776e8b71b5.png#clientId=u73405852-6468-4&errorMessage=unknown%20error&from=paste&id=u4ba21194&originHeight=619&originWidth=955&originalType=url&ratio=1&rotation=0&showTitle=false&status=error&style=none&taskId=u9b4959b7-f61a-4a72-b464-bb669b4db05&title=)
### æ–°å»ºä»»åŠ¡
![](https://cdn.nlark.com/yuque/0/2022/png/25916449/1665988833063-b3363dc4-fcc3-4fb9-af9e-efb87022ee69.png#clientId=u73405852-6468-4&errorMessage=unknown%20error&from=paste&id=ua9bb768f&originHeight=806&originWidth=1398&originalType=url&ratio=1&rotation=0&showTitle=false&status=error&style=none&taskId=u087b44de-d853-4dec-a656-7a1174e4d78&title=)
### é…ç½® git ä»“åº“åœ°å€
![](https://cdn.nlark.com/yuque/0/2022/png/25916449/1665988832950-3aca12da-cc91-46a0-9c6b-b7423f0fa37e.png#clientId=u73405852-6468-4&errorMessage=unknown%20error&from=paste&id=u17def811&originHeight=822&originWidth=1272&originalType=url&ratio=1&rotation=0&showTitle=false&status=error&style=none&taskId=u4b773947-e455-4ce1-b949-5175a083496&title=)
### æ„å»ºï¼ˆæ‰“åŒ…ï¼‰
![](https://cdn.nlark.com/yuque/0/2022/png/25916449/1665988833303-2ebbe4e4-081d-4430-8fc3-123a8cda1443.png#clientId=u73405852-6468-4&errorMessage=unknown%20error&from=paste&id=u2d7cd358&originHeight=312&originWidth=1232&originalType=url&ratio=1&rotation=0&showTitle=false&status=error&style=none&taskId=uc32c42d7-f9dc-413c-8d1b-028472f5326&title=)
åç½®æ“ä½œï¼ˆæ„å»ºä¹‹åæ‰§è¡Œï¼‰
![image.png](https://cdn.nlark.com/yuque/0/2022/png/22293976/1666059935415-3cc770c2-522e-4d49-9662-bcb2ad4433bd.png#clientId=u85a131e3-218b-4&errorMessage=unknown%20error&from=paste&height=695&id=ub5dae660&name=image.png&originHeight=869&originWidth=1683&originalType=binary&ratio=1&rotation=0&showTitle=false&size=55832&status=error&style=none&taskId=u95078f6e-8781-421b-aaf0-48161e01e16&title=&width=1346.4)
## å®¿ä¸»æœºå®‰è£… Compose [ğŸ”—](https://docs.docker.com/compose/install/linux/#install-compose)
```shell
curl -L "https://github.com/docker/compose/releases/download/1.29.2/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
chmod +x /usr/local/bin/docker-compose
docker-compose --version
```
## åˆ›å»ºDockerç½‘æ ¼
```shell
docker network create docker_mete_pro_node
```
## è¿è¡ŒMySQLé•œåƒ
```shell
docker pull mysql:5.7
docker run -d -p 3306:3306 --network docker_mete_pro_node --privileged=true -v /meta_pro/mysql/log:/var/log/mysql -v /meta_pro/mysql/data:/var/lib/mysql -v /meta_pro/mysql/conf:/etc/mysql/conf.d -e MYSQL_ROOT_PASSWORD=tVD2QSx5tjh2b9ca --hostnapro-mysql --name meta-pro-mysql mysql:5.7
vim /meta_pro/mysql/conf/my.cnf

## ä½¿ç”¨å¦‚ä¸‹é…ç½®
[client]
default_character_set=utf8mb4
[mysqld]
collation_server=utf8mb4_unicode_ci
character_set_server=utf8mb4
default-time_zone = '+8:00'
sql_mode='STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION'

## ä¿®æ”¹å®Œé…ç½®åé‡å¯meta-pro-mysqlå®ä¾‹
docker restart meta-pro-mysql
```
## ç›¸å…³è„šæœ¬ï¼Œé…ç½®æ–‡ä»¶
### docker-compose.yml
```yaml
version: '3'
services:
meta-pro-nacos:
container_name: meta-pro-nacos
hostname: meta-pro-nacos
image: nacos/nacos-server
build:
context: ./nacos
restart: always
privileged: true
tty: true
environment:
- MODE=standalone
ports:
- "8848:8848"
- "9848:9848"
- "9849:9849"
networks:
- mete_pro_node
meta-pro-nginx:
container_name: meta-pro-nginx
image: nginx
build:
context: ./nginx
restart: always
privileged: true
tty: true
ports:
- "80:80"
- "443:443"
volumes:
- /meta_pro/nginx/html/client/dist:/home/mz/projects/meta-pro-client
- /meta_pro/nginx/html/manage/dist:/home/mz/projects/meta-pro-manage
- /var/meta-pro/uploadPath:/home/mz/projects/meta-pro-manage/uploadPath
- /var/meta-pro/uploadPath:/home/mz/projects/meta-pro-client/uploadPath
networks:
- mete_pro_node
meta-pro-redis:
container_name: meta-pro-redis
hostname: meta-pro-redis
image: redis
build:
context: ./redis
restart: always
privileged: true
tty: true
ports:
- "6379:6379"
networks:
- mete_pro_node
command: redis-server /home/mz/redis/redis.conf

meta-pro-gateway:
container_name: meta-pro-gateway
hostname: meta-pro-gateway
build:
context: mz/gateway
dockerfile: dockerfile
restart: always
privileged: true
tty: true
volumes:
- /meta_pro/gateway:/home/mz/logs/
deploy:
resources:
limits:
memory: 1024M
ports:
- "8090:8090"
networks:
- mete_pro_node
meta-pro-auth:
container_name: meta-pro-auth
hostname: meta-pro-auth
build:
context: mz/auth
dockerfile: dockerfile
restart: always
privileged: true
tty: true
volumes:
- /meta_pro/auth:/home/mz/logs/
deploy:
resources:
limits:
memory: 400M
ports:
- "9200:9200"
networks:
- mete_pro_node
meta-pro-modules-system:
container_name: meta-pro-modules-system
hostname: meta-pro-modules-system
build:
context: mz/modules/system
dockerfile: dockerfile
restart: always
privileged: true
tty: true
volumes:
- /meta_pro/system:/home/mz/logs/
deploy:
resources:
limits:
memory: 400M
ports:
- "9201:9201"
networks:
- mete_pro_node
meta-pro-modules-client:
container_name: meta-pro-modules-client
hostname: meta-pro-modules-client
build:
context: mz/modules/client
dockerfile: dockerfile
restart: always
privileged: true
tty: true
volumes:
- /meta_pro/client:/home/mz/logs/
- /var/meta-pro/uploadPath:/home/mz/projects/meta-pro-client/uploadPath/
deploy:
resources:
limits:
memory: 2048M
ports:
- "9205:9205"
networks:
- mete_pro_node
meta-pro-modules-gen:
container_name: meta-pro-modules-gen
hostname: meta-pro-modules-gen
build:
context: mz/modules/gen
dockerfile: dockerfile
restart: always
privileged: true
tty: true
volumes:
- /meta_pro/gen:/home/mz/logs/
deploy:
resources:
limits:
memory: 400M
ports:
- "9202:9202"
networks:
- mete_pro_node
meta-pro-modules-job:
container_name: meta-pro-modules-job
hostname: meta-pro-modules-job
build:
context: mz/modules/job
dockerfile: dockerfile
restart: always
privileged: true
tty: true
volumes:
- /meta_pro/job:/home/mz/logs/
deploy:
resources:
limits:
memory: 400M
ports:
- "9203:9203"
networks:
- mete_pro_node
meta-pro-modules-file:
container_name: meta-pro-modules-file
hostname: meta-pro-modules-file
build:
context: mz/modules/file
dockerfile: dockerfile
restart: always
privileged: true
tty: true
volumes:
- /meta_pro/uploadPath:/home/mz/uploadPath/
- /meta_pro/file:/home/mz/logs/
deploy:
resources:
limits:
memory: 400M
ports:
- "9300:9300"
networks:
- mete_pro_node
meta-pro-visual-monitor:
container_name: meta-pro-visual-monitor
hostname: meta-pro-visual-monitor
build:
context: mz/visual/monitor
dockerfile: dockerfile
restart: always
privileged: true
tty: true
volumes:
- /meta_pro/monitor:/home/mz/logs/
deploy:
resources:
limits:
memory: 400M
ports:
- "9100:9100"
networks:
- mete_pro_node
networks:
mete_pro_node:
driver: bridge
```
### jenkins-publish.sh
```shell
#!/bin/sh
# mete-proå¾®æœåŠ¡çš„jenkinsè‡ªåŠ¨å‘å¸ƒè„šæœ¬

cd docker

# copy jar
  echo "begin copy meta-pro-gateway "
  cp ../meta-pro-gateway/target/meta-pro-gateway.jar ./mz/gateway/jar

  echo "begin copy meta-pro-auth "
  cp ../meta-pro-auth/target/meta-pro-auth.jar ./mz/auth/jar

  echo "begin copy meta-pro-visual "
  cp ../meta-pro-visual/meta-pro-visual-monitor/target/meta-pro-visual-monitor.jar  ./mz/visual/monitor/jar

  echo "begin copy meta-pro-modules-system "
  cp ../meta-pro-modules/meta-pro-modules-system/target/meta-pro-modules-system.jar ./mz/modules/system/jar

  echo "begin copy meta-pro-modules-file "
  cp ../meta-pro-modules/meta-pro-modules-file/target/meta-pro-modules-file.jar ./mz/modules/file/jar

  echo "begin copy meta-pro-modules-job "
  cp ../meta-pro-modules/meta-pro-modules-job/target/meta-pro-modules-job.jar ./mz/modules/job/jar

  echo "begin copy meta-pro-modules-gen "
  cp ../meta-pro-modules/meta-pro-modules-gen/target/meta-pro-modules-gen.jar ./mz/modules/gen/jar

  echo "begin copy meta-pro-modules-client "
  cp ../meta-pro-modules/meta-pro-modules-client/target/meta-pro-modules-client.jar ./mz/modules/client/jar

  echo "begin copy mz project and docker-compose.yml..."
  cp -rp mz /meta_pro/docker
  cp docker-compose.yml /meta_pro/docker

  # é¦–æ¬¡åˆå§‹åŒ–æ—¶ éœ€è¦æ‹·è´nacos redis nginxçš„é…ç½®
  cp -rp nacos /meta_pro/docker
  cp -rp redis /meta_pro/docker
  cp -rp nginx /meta_pro/docker

  echo "cd /meta_pro/docker..."
  cd /meta_pro/docker

  # åœæ­¢mete-proçš„JavaæœåŠ¡
  if [ $(docker ps -a | grep  docker_meta-pro | grep -c Up | awk '{print $1}') != 0 ]
  	then
  		echo "Stopping the Java service"
  		docker stop $(docker ps | grep  docker_meta-pro | awk '{print $1}')
  # åˆ é™¤ç›¸å…³å®¹å™¨
  		docker rm -f $(docker ps -a | grep  docker_meta-pro | awk '{print $1}')
  fi

  # æ¸…é™¤è™šæ‚¬é•œåƒ
  if [ $(docker images | grep -c none) != 0 ]
  	then
  		echo "Is cleared mistake mirror"
  		docker rmi -f $(docker images | grep none | awk '{print $3}')
  fi

  # æ¸…é™¤meta-proçš„JavaæœåŠ¡é•œåƒ
  if [ $(docker images | grep -c  docker_meta-pro) != 0 ]
  	then
  		echo "Is cleared Java mirror"
  		docker rmi -f $(docker images | grep  docker_meta-pro | awk '{print $3}')
  fi

  # å¯åŠ¨å®¹å™¨æœåŠ¡
  docker-compose -f /meta_pro/docker/docker-compose.yml up -d
```
